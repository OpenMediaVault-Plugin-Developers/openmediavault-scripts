version: '1.0'
type: component
data:
  name: omv-services-scripts-scripts-datatable-page
  type: datatablePage
  config:
    autoReload: false
    hasSearchField: true
    rowId: name
    stateId: 0ea95af4-fabd-11ee-8e48-33c0392725c0
    sorters:
      - dir: asc
        prop: name
    store:
      proxy:
        service: Scripts
        get:
          method: getScriptList
    columns:
      - name: _('Name')
        prop: name
        flexGrow: 1
        sortable: true
      - name: _('Extension')
        prop: ext
        flexGrow: 1
        sortable: true
      - name: _('Testing Arguments')
        prop: testargs
        flexGrow: 1
        sortable: true
      - name: _('Full Path')
        prop: fullpath
        flexGrow: 2
        sortable: true
        hidden: true
        cellTemplateName: copyToClipboard
    actions:
      - type: menu
        icon: add
        tooltip: _("Add")
        actions:
          - text: _("Add")
            icon: mdi:text-box-plus-outline
            execute:
              type: url
              url: '/services/scripts/script/create'
          - text: _("Add Python")
            icon: mdi:text-box-plus-outline
            execute:
              type: url
              url: '/services/scripts/script/createpy'
          - text: _("Import")
            icon: mdi:import
            execute:
              type: formDialog
              formDialog:
                title: _("Import existing scripts ...")
                fields:
                  - type: hint
                    hintType: info
                    text: _("This will import one or more scripts in the selected folder.<br/>It will not import any scripts that already exist in the plugin.")
                  - type: hidden
                    name: rootfsref
                    value: "79684322-3eac-11ea-a974-63a080abab18"
                    submitValue: false
                  - type: folderBrowser
                    name: path
                    label: _("Path")
                    value: ""
                    dirType: mntent
                    dirRefIdField: rootfsref
                    validators:
                      required: true
                buttons:
                  submit:
                    text: _("Import")
                    execute:
                      type: request
                      request:
                        service: Scripts
                        method: importExistingFolder
          - text: _("Import one")
            icon: mdi:file-import-outline
            execute:
              type: formDialog
              formDialog:
                title: _("Import one existing script ...")
                fields:
                  - type: hint
                    hintType: info
                    text: _("This will import one script from the specified path.<br/>It will not import a script that already exist in the plugin.")
                  - type: textInput
                    name: path
                    label: _("Path")
                    value: ""
                    validators:
                      required: true
                buttons:
                  submit:
                    text: _("Import")
                    execute:
                      type: request
                      request:
                        service: Scripts
                        method: importExistingOne
      - type: iconButton
        icon: edit
        tooltip: _('Edit')
        enabledConstraints:
          minSelected: 1
          maxSelected: 1
          constraint:
            - operator: ne
              arg0:
                prop: ext
              arg1: 'py'
        execute:
          type: url
          url: '/services/scripts/script/edit/{{ _selected[0].uuid }}'
      - type: iconButton
        icon: edit
        tooltip: _('Edit python')
        enabledConstraints:
          minSelected: 1
          maxSelected: 1
          constraint:
            - operator: eq
              arg0:
                prop: ext
              arg1: 'py'
        execute:
          type: url
          url: '/services/scripts/script/editpy/{{ _selected[0].uuid }}'
      - template: delete
        confirmationDialogConfig:
          template: confirmation-danger
          message: _('This action will delete this script and all scheduled jobs for this script.<br/>Are you sure you want to delete?')
        execute:
          type: request
          request:
            service: Scripts
            method: deleteScript
            params:
              uuid: '{{ _selected[0].uuid }}'
      - type: iconButton
        icon: mdi:text-box-check-outline
        tooltip: _('Shellcheck')
        enabledConstraints:
          minSelected: 1
          maxSelected: 1
          constraint:
            - operator: or
              arg0:
                operator: eq
                arg0:
                  prop: ext
                arg1: 'sh'
              arg1:
                operator: eq
                arg0:
                  prop: ext
                arg1: 'ksh'
        execute:
          type: taskDialog
          taskDialog:
            config:
              title: _('Shellcheck ...')
              startOnInit: true
              request:
                service: Scripts
                method: doShellcheck
                params:
                  uuid: '{{ _selected[0].uuid }}'
      - type: iconButton
        icon: mdi:play-outline
        tooltip: _('Run')
        enabledConstraints:
          minSelected: 1
          maxSelected: 1
          constraint:
            - operator: and
              arg0:
                operator: ne
                arg0:
                  prop: ext
                arg1: 'conf'
              arg1:
                operator: ne
                arg0:
                  prop: ext
                arg1: 'txt'
        execute:
          type: taskDialog
          taskDialog:
            config:
              title: _('Run script ...')
              request:
                service: Scripts
                method: doRun
                params:
                  uuid: '{{ _selected[0].uuid }}'
      - type: iconButton
        icon: mdi:link
        tooltip: _("Docs")
        execute:
          type: url
          url: "/externalRedirect/https%3A%2F%2Fwiki.omv-extras.org%2Fdoku.php%3Fid%3Domv7%3Aomv7_plugins%3Ascripts"
